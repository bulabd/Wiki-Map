<!-- //displays a singular map based on ID from routes -->
<!DOCTYPE html>
<html>
  <head>
    <%- include('partials/_head') %>
    <link rel="stylesheet" href="/styles/mapView.css" type="text/css" />
    <title>Edit Map</title>
  </head>
  <body>
    <header>
      <nav class="navBar">
        <div class="WikiMapsLogo">
          <h1>WikiMaps</h1>
          <i class="fa-solid fa-signs-post"></i>
        </div>
        <div class="navButtons">
          <a href="/maps" class="link-dark">&#43;View All Maps</a>
          <a href="/maps" class="link-dark">&#43;My Maps</a>
          <a href="/create" class="link-dark">&#43;Create Map</a>
          <form method="GET" action="/logout">
            <button class="btn btn-outline link-dark">&#43;Logout</button>
          </form>
        </div>
      </nav>
    </header>
    <main>
      <div class="contentbox">
        <% if (map.title) {%>
          <div class="columnContainer">
            <div id="title&isfave" class="rowContainer">
              <h2><%= map.title %></h2>
              <!-- Favourite item below, need to implement it into a button that changes isFavourite value in db -->
              <form method="post" action="update">
                <input type="checkbox" name="isFavourite" value="<%= Boolean(!map.isFavourite).toString() %>" />
                <button type="submit" class="bg-transparent"><i class="<%= map.isFavourite ? 'fa-solid fa-star' : 'fa-regular fa-star' %>"></i>
                </button>
              </form>
            </div>
            <article class="mapContainer">
              <p><%= map.description %></p>
              <div id="googleMap" style="width:100%;height:400px;" class="mapItem" data-initial_lat="<%= map.initial_lat %>" data-initial_long="<%= map.initial_long %>" data-markers="<%= markers %>"></div>
              <script>
                function myMap() {

                  const mapElement = document.getElementById("googleMap");
                  const map1 = new google.maps.Map(mapElement, {
                    zoom: 10,
                    center: { lat: Number(mapElement.getAttribute('data-initial_lat')), lng: Number(mapElement.getAttribute('data-initial_long')) }
                  });

                  let markersArr = JSON.parse(mapElement.getAttribute('data-markers'));
                  console.log(markersArr);
                  for (let marker of markersArr) {

                    let marker_varriable = new google.maps.Marker({
                      position: { lat: Number(marker.latitude), lng: Number(marker.longitude)},
                      map: map1,
                      title: marker.title
                    });

                    let contentString =
                    `<img  src="${marker.image_url}" alt="Image of the marker" width="100vh" height="70vh">` +
                    `<h4>${marker.title}</h4>` +
                    `<p>${marker.description}</p>`;
                    const infoWindow = new google.maps.InfoWindow({
                      content: contentString
                    });
                    marker_varriable.addListener("click", () => {
                      infoWindow.open({
                        anchor: marker_varriable,
                        map: map1,
                        shouldFocus: false
                      });
                    });
                  }

                }
                </script>
          <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDefdAke6ccRvSJ6kOWOMs6C3josatbsPo&callback=myMap"></script>
        </div>

        <form method="POST" action="/maps/<%= map_id %>/edit?param=addMarker">
          <h4><b>Add a new marker:</b></h4>
          <label for="title">&#43;Title: </label>
          <input type="text" name="title" placeholder="Title" class="box">
          <label for="title">&#43;Description: </label>
          <input type="text" name="description" placeholder="Description" class="box">
          <label for="image_url">&#43;Image URL: </label>
          <input type="text" name="image_url" placeholder="URL" class="box">
          <label for="latitude">&#43;Latitude: </label>
          <input type="number" step="0.000000000000001" name="latitude" placeholder="Latitude" class="box">
          <label for="longitude">&#43;Longitude: </label>
          <input type="number" step="0.000000000000001" name="longitude" placeholder="Longitude" class="box">
          <label for="type">&#43;Type of marker: </label>
          <input type="text" name="type" placeholder="Type" class="box">
          <button type="submit" class="redbuttons">&#43;Submit</button>
        </form>

        <form method="POST" action="/maps/<%= map_id %>/edit?param=updateMarker">
          <h4><b>Update marker:</b></h4>
          <label for="title">&#43;Title of Marker: </label>
          <input type="text" name="title" placeholder="Title" class="box">
          <label for="title">&#43;New Title: </label>
          <input type="text" name="new_title" placeholder="New Title" class="box">
          <label for="title">&#43;Description: </label>
          <input type="text" name="description" placeholder="Description" class="box">
          <label for="image_url">&#43;Image URL: </label>
          <input type="text" name="image_url" placeholder="URL" class="box">
          <label for="latitude">&#43;Latitude: </label>
          <input type="number" step="0.000000000000001" name="latitude" placeholder="Latitude" class="box">
          <label for="longitude">&#43;Longitude: </label>
          <input type="number" step="0.000000000000001" name="longitude" placeholder="Longitude" class="box">
          <label for="type">&#43;Type of marker: </label>
          <input type="text" name="type" placeholder="Type" class="box">
          <button type="submit" class="redbuttons">&#43;Submit</button>
        </form>

        <form method="POST" action="/maps/<%= map_id %>/edit?param=deleteMarker">
          <label for="title">&#43;Title of marker to delete: </label>
          <input type="text" name="id" placeholder="Marker Title" class="box">
          <button type="submit" class="redbuttons">&#43;Delete Marker!</button>
        </form>

        <form method="POST" action="/maps/<%= map_id %>/edit?param=deleteMap">
          <button type="submit" class="redbuttons">&#43;Delete Map!</button>
        </form>

      </article>
      <% } %>
    </div>
    </main>
    <%- include('partials/_footer') %>
  </body>
</html>


    <!-- AIzaSyDefdAke6ccRvSJ6kOWOMs6C3josatbsPo -->
