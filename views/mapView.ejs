<!-- //displays a singular map based on ID from routes -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/b383617d0a.js" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="/styles/mapView.css" type="text/css" />
    <link rel="stylesheet" href="/styles/commonStyles.css" type="text/css" />
    <title>Map View</title>
  </head>
  <body>
    <header>
      <nav class="navBar">
        <div class="WikiMapsLogo">
          <h1>WikiMaps</h1>
          <i class="fa-solid fa-signs-post"></i>
        </div>
        <div>
          <a href="/maps">View All Maps</a>
          <form method="GET" action="/logout">
          <a href="/login"><button class="btn btn-outline">Logout</button></a>
          </form>
        </div>
      </nav>
    </header>
    <% if (map.title) {%>
    <div class="columnContainer">
    <div id="title&isfave" class="rowContainer">
    <h2><%= map.title %></h2>
    <!-- Favourite item below, need to implement it into a button that changes isFavourite value in db -->
    <form method="post" action="update">
      <input type="checkbox" name="isFavourite" value="<%= Boolean(!map.isFavourite).toString() %>" />
      <button type="submit" class="bg-transparent"><i class="<%= map.isFavourite ? 'fa-solid fa-star' : 'fa-regular fa-star' %>"></i>
    </button>
    </form>
    </div>
    <article class="mapContainer">
      <p><%= map.description %></p>
      <div id="googleMap" style="width:100%;height:400px;" class="mapItem" data-initial_lat="<%= map.initial_lat %>" data-initial_long="<%= map.initial_long %>" data-markers="<%= markers %>"></div>
      <script>
        function myMap() {

          const mapElement = document.getElementById("googleMap");
          const map1 = new google.maps.Map(mapElement, {
            zoom: 10,
            center: { lat: Number(mapElement.getAttribute('data-initial_lat')), lng: Number(mapElement.getAttribute('data-initial_long')) }
          });

          let markersArr = JSON.parse(mapElement.getAttribute('data-markers'));
          console.log(markersArr);
          for (let marker of markersArr) {

            let marker_varriable = new google.maps.Marker({
              position: { lat: Number(marker.latitude), lng: Number(marker.longitude)},
              map: map1,
              title: marker.title
            });

            let contentString =
              `<img  src="${marker.image_url}" alt="Image of the marker" width="100vh" height="70vh">` +
              `<h4>${marker.title}</h4>` +
              `<p>${marker.description}</p>`;
            const infoWindow = new google.maps.InfoWindow({
              content: contentString
            });
            marker_varriable.addListener("click", () => {
              infoWindow.open({
                anchor: marker_varriable,
                map: map1,
                shouldFocus: false
              });
            });
          }

        }
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDefdAke6ccRvSJ6kOWOMs6C3josatbsPo&callback=myMap"></script>
        <% if (button === true) {%>
        <button type="button" class="btn btn-secondary" id="editbutton" onclick="location.href='edit'">Edit Map</button>
        <% } %>
      </div>
    </article>
    <% } %>
  </body>
</html>


    <!-- AIzaSyDefdAke6ccRvSJ6kOWOMs6C3josatbsPo -->
